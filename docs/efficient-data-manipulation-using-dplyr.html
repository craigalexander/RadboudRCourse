<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3.5 Efficient data manipulation using dplyr | Visualising Data using R</title>
  <meta name="description" content="This short introductory module provides an introduction to using R and how to visualise data within R." />
  <meta name="generator" content="bookdown 0.25 and GitBook 2.6.7" />

  <meta property="og:title" content="3.5 Efficient data manipulation using dplyr | Visualising Data using R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This short introductory module provides an introduction to using R and how to visualise data within R." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3.5 Efficient data manipulation using dplyr | Visualising Data using R" />
  
  <meta name="twitter:description" content="This short introductory module provides an introduction to using R and how to visualise data within R." />
  

<meta name="author" content="Craig Alexander, Eilidh Jack &amp; Marnie Low" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="reading-in-data-using-readr.html"/>
<link rel="next" href="creating-graphics-with-ggplot2.html"/>
<script src="assets/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="assets/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="assets/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="assets/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="assets/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li><a href="index.html#overview" id="toc-overview"><span class="toc-section-number">1</span> Overview<span></span></a>
<ul>
<li><a href="the-ggplot2-package.html#the-ggplot2-package" id="toc-the-ggplot2-package"><span class="toc-section-number">1.1</span> The <code>ggplot2</code> package<span></span></a></li>
<li><a href="data.html#data" id="toc-data"><span class="toc-section-number">1.2</span> Data<span></span></a></li>
<li><a href="libraries.html#libraries" id="toc-libraries"><span class="toc-section-number">1.3</span> Libraries<span></span></a></li>
</ul></li>
<li><a href="intro.html#intro" id="toc-intro"><span class="toc-section-number">2</span> Getting Started<span></span></a>
<ul>
<li><a href="setting-up-r.html#setting-up-r" id="toc-setting-up-r"><span class="toc-section-number">2.1</span> Setting up R<span></span></a>
<ul>
<li><a href="setting-up-r.html#downloading-and-installing-r-for-windows" id="toc-downloading-and-installing-r-for-windows"><span class="toc-section-number">2.1.1</span> Downloading and installing R for Windows<span></span></a></li>
<li><a href="setting-up-r.html#downloading-and-installing-r-for-mac" id="toc-downloading-and-installing-r-for-mac"><span class="toc-section-number">2.1.2</span> Downloading and installing R for Mac<span></span></a></li>
</ul></li>
<li><a href="rstudio.html#rstudio" id="toc-rstudio"><span class="toc-section-number">2.2</span> RStudio<span></span></a>
<ul>
<li><a href="rstudio.html#installing-rstudio-for-windowsmac" id="toc-installing-rstudio-for-windowsmac"><span class="toc-section-number">2.2.1</span> Installing RStudio for Windows/Mac<span></span></a></li>
</ul></li>
<li><a href="r-packages.html#r-packages" id="toc-r-packages"><span class="toc-section-number">2.3</span> R packages<span></span></a></li>
</ul></li>
<li><a href="efficient-data-management-in-r.html#efficient-data-management-in-r" id="toc-efficient-data-management-in-r"><span class="toc-section-number">3</span> Efficient Data Management in R<span></span></a>
<ul>
<li><a href="tidyverse.html#tidyverse" id="toc-tidyverse"><span class="toc-section-number">3.1</span> Tidyverse<span></span></a></li>
<li><a href="pipelines.html#pipelines" id="toc-pipelines"><span class="toc-section-number">3.2</span> Pipelines<span></span></a>
<ul>
<li><a href="pipelines.html#task" id="toc-task"><span class="toc-section-number">3.2.1</span> Task<span></span></a></li>
<li><a href="pipelines.html#solution" id="toc-solution"><span class="toc-section-number">3.2.2</span> Solution<span></span></a></li>
<li><a href="pipelines.html#task-1" id="toc-task-1"><span class="toc-section-number">3.2.3</span> Task<span></span></a></li>
<li><a href="pipelines.html#answer" id="toc-answer"><span class="toc-section-number">3.2.4</span> Answer<span></span></a></li>
<li><a href="pipelines.html#additional-resources" id="toc-additional-resources"><span class="toc-section-number">3.2.5</span> Additional Resources<span></span></a></li>
</ul></li>
<li><a href="tibbles.html#tibbles" id="toc-tibbles"><span class="toc-section-number">3.3</span> Tibbles<span></span></a>
<ul>
<li><a href="tibbles.html#creating-tibbles" id="toc-creating-tibbles"><span class="toc-section-number">3.3.1</span> Creating tibbles<span></span></a></li>
<li><a href="tibbles.html#working-with-tibbles" id="toc-working-with-tibbles"><span class="toc-section-number">3.3.2</span> Working with tibbles<span></span></a></li>
<li><a href="tibbles.html#subsetting-tibbles-always-results-in-a-tibble" id="toc-subsetting-tibbles-always-results-in-a-tibble"><span class="toc-section-number">3.3.3</span> Subsetting tibbles always results in a tibble<span></span></a></li>
</ul></li>
<li><a href="reading-in-data-using-readr.html#reading-in-data-using-readr" id="toc-reading-in-data-using-readr"><span class="toc-section-number">3.4</span> Reading in data using readr<span></span></a>
<ul>
<li><a href="reading-in-data-using-readr.html#task-2" id="toc-task-2"><span class="toc-section-number">3.4.1</span> Task<span></span></a></li>
<li><a href="reading-in-data-using-readr.html#answer-1" id="toc-answer-1"><span class="toc-section-number">3.4.2</span> Answer<span></span></a></li>
<li><a href="reading-in-data-using-readr.html#specifying-column-types" id="toc-specifying-column-types"><span class="toc-section-number">3.4.3</span> Specifying column types<span></span></a></li>
<li><a href="reading-in-data-using-readr.html#additional-resources-1" id="toc-additional-resources-1"><span class="toc-section-number">3.4.4</span> Additional Resources<span></span></a></li>
</ul></li>
<li><a href="efficient-data-manipulation-using-dplyr.html#efficient-data-manipulation-using-dplyr" id="toc-efficient-data-manipulation-using-dplyr"><span class="toc-section-number">3.5</span> Efficient data manipulation using dplyr<span></span></a>
<ul>
<li><a href="efficient-data-manipulation-using-dplyr.html#overview-the-key-functions-verbs-for-dplyr" id="toc-overview-the-key-functions-verbs-for-dplyr"><span class="toc-section-number">3.5.1</span> Overview: the key functions (“verbs”) for <code>dplyr</code><span></span></a></li>
<li><a href="efficient-data-manipulation-using-dplyr.html#selecting-observations-rows-using-filter-and-slice" id="toc-selecting-observations-rows-using-filter-and-slice"><span class="toc-section-number">3.5.2</span> Selecting observations (rows) using <code>filter</code> and <code>slice</code><span></span></a></li>
<li><a href="efficient-data-manipulation-using-dplyr.html#task-3" id="toc-task-3"><span class="toc-section-number">3.5.3</span> Task<span></span></a></li>
<li><a href="efficient-data-manipulation-using-dplyr.html#answer-2" id="toc-answer-2"><span class="toc-section-number">3.5.4</span> Answer<span></span></a></li>
<li><a href="efficient-data-manipulation-using-dplyr.html#selecting-variables-columns-using-select" id="toc-selecting-variables-columns-using-select"><span class="toc-section-number">3.5.5</span> Selecting variables (columns) using <code>select</code><span></span></a></li>
<li><a href="efficient-data-manipulation-using-dplyr.html#adding-new-variables-using-mutate" id="toc-adding-new-variables-using-mutate"><span class="toc-section-number">3.5.6</span> Adding new variables using <code>mutate</code><span></span></a></li>
<li><a href="efficient-data-manipulation-using-dplyr.html#task-4" id="toc-task-4"><span class="toc-section-number">3.5.7</span> Task<span></span></a></li>
<li><a href="efficient-data-manipulation-using-dplyr.html#answer-3" id="toc-answer-3"><span class="toc-section-number">3.5.8</span> Answer<span></span></a></li>
<li><a href="efficient-data-manipulation-using-dplyr.html#sorting-data-sets-using-arrange" id="toc-sorting-data-sets-using-arrange"><span class="toc-section-number">3.5.9</span> Sorting data sets using <code>arrange</code><span></span></a></li>
<li><a href="efficient-data-manipulation-using-dplyr.html#task-5" id="toc-task-5"><span class="toc-section-number">3.5.10</span> Task<span></span></a></li>
<li><a href="efficient-data-manipulation-using-dplyr.html#answer-4" id="toc-answer-4"><span class="toc-section-number">3.5.11</span> Answer<span></span></a></li>
<li><a href="efficient-data-manipulation-using-dplyr.html#grouping-data-and-calculating-group-wise-summary-statistics-group_by-and-summarise" id="toc-grouping-data-and-calculating-group-wise-summary-statistics-group_by-and-summarise"><span class="toc-section-number">3.5.12</span> Grouping data and calculating group-wise summary statistics: <code>group_by</code> and <code>summarise</code><span></span></a></li>
<li><a href="efficient-data-manipulation-using-dplyr.html#task-6" id="toc-task-6"><span class="toc-section-number">3.5.13</span> Task<span></span></a></li>
<li><a href="efficient-data-manipulation-using-dplyr.html#answer-5" id="toc-answer-5"><span class="toc-section-number">3.5.14</span> Answer<span></span></a></li>
<li><a href="efficient-data-manipulation-using-dplyr.html#merging-joining-data-sets-using-the-join-type-functions" id="toc-merging-joining-data-sets-using-the-join-type-functions"><span class="toc-section-number">3.5.15</span> Merging (joining) data sets using the <code>join</code>-type functions<span></span></a></li>
<li><a href="efficient-data-manipulation-using-dplyr.html#additional-resources-2" id="toc-additional-resources-2"><span class="toc-section-number">3.5.16</span> Additional Resources<span></span></a></li>
</ul></li>
</ul></li>
<li><a href="creating-graphics-with-ggplot2.html#creating-graphics-with-ggplot2" id="toc-creating-graphics-with-ggplot2"><span class="toc-section-number">4</span> Creating Graphics with <code>ggplot2</code><span></span></a>
<ul>
<li><a href="ggplot-terms.html#ggplot-terms" id="toc-ggplot-terms"><span class="toc-section-number">4.1</span> ggplot terms<span></span></a>
<ul>
<li><a href="ggplot-terms.html#geometric-objects" id="toc-geometric-objects"><span class="toc-section-number">4.1.1</span> Geometric objects<span></span></a></li>
<li><a href="ggplot-terms.html#aesthetics" id="toc-aesthetics"><span class="toc-section-number">4.1.2</span> Aesthetics<span></span></a></li>
</ul></li>
<li><a href="using-the-more-general-ggplot-interface.html#using-the-more-general-ggplot-interface" id="toc-using-the-more-general-ggplot-interface"><span class="toc-section-number">4.2</span> Using the more general ggplot interface<span></span></a>
<ul>
<li><a href="using-the-more-general-ggplot-interface.html#a-typical-ggplot-call" id="toc-a-typical-ggplot-call"><span class="toc-section-number">4.2.1</span> A typical ggplot call<span></span></a></li>
<li><a href="using-the-more-general-ggplot-interface.html#adding-additional-layers" id="toc-adding-additional-layers"><span class="toc-section-number">4.2.2</span> Adding additional layers<span></span></a></li>
<li><a href="using-the-more-general-ggplot-interface.html#explicit-drawing" id="toc-explicit-drawing"><span class="toc-section-number">4.2.3</span> Explicit drawing<span></span></a></li>
<li><a href="using-the-more-general-ggplot-interface.html#task-7" id="toc-task-7"><span class="toc-section-number">4.2.4</span> Task<span></span></a></li>
<li><a href="using-the-more-general-ggplot-interface.html#answer-6" id="toc-answer-6"><span class="toc-section-number">4.2.5</span> Answer<span></span></a></li>
</ul></li>
<li><a href="modifying-plots.html#modifying-plots" id="toc-modifying-plots"><span class="toc-section-number">4.3</span> Modifying Plots<span></span></a>
<ul>
<li><a href="modifying-plots.html#labels-and-titles" id="toc-labels-and-titles"><span class="toc-section-number">4.3.1</span> Labels and titles<span></span></a></li>
<li><a href="modifying-plots.html#scales" id="toc-scales"><span class="toc-section-number">4.3.2</span> Scales<span></span></a></li>
<li><a href="modifying-plots.html#statistics" id="toc-statistics"><span class="toc-section-number">4.3.3</span> Statistics<span></span></a></li>
<li><a href="modifying-plots.html#theming" id="toc-theming"><span class="toc-section-number">4.3.4</span> Theming<span></span></a></li>
<li><a href="modifying-plots.html#arranging-plots-faceting" id="toc-arranging-plots-faceting"><span class="toc-section-number">4.3.5</span> Arranging plots (faceting)<span></span></a></li>
</ul></li>
</ul></li>
<li><a href="handling-date-time-data-with-lubridate.html#handling-date-time-data-with-lubridate" id="toc-handling-date-time-data-with-lubridate"><span class="toc-section-number">5</span> Handling date-time data with <code>lubridate</code><span></span></a>
<ul>
<li><a href="creating-datetimes.html#creating-datetimes" id="toc-creating-datetimes"><span class="toc-section-number">5.1</span> Creating date/times<span></span></a>
<ul>
<li><a href="creating-datetimes.html#from-strings" id="toc-from-strings"><span class="toc-section-number">5.1.1</span> From strings<span></span></a></li>
<li><a href="creating-datetimes.html#from-individual-components" id="toc-from-individual-components"><span class="toc-section-number">5.1.2</span> From individual components<span></span></a></li>
<li><a href="creating-datetimes.html#from-existing-types" id="toc-from-existing-types"><span class="toc-section-number">5.1.3</span> From existing types<span></span></a></li>
</ul></li>
<li><a href="date-time-components.html#date-time-components" id="toc-date-time-components"><span class="toc-section-number">5.2</span> Date-time Components<span></span></a>
<ul>
<li><a href="date-time-components.html#time-spans" id="toc-time-spans"><span class="toc-section-number">5.2.1</span> Time Spans<span></span></a></li>
<li><a href="date-time-components.html#durations" id="toc-durations"><span class="toc-section-number">5.2.2</span> Durations<span></span></a></li>
<li><a href="date-time-components.html#periods" id="toc-periods"><span class="toc-section-number">5.2.3</span> Periods<span></span></a></li>
<li><a href="date-time-components.html#intervals" id="toc-intervals"><span class="toc-section-number">5.2.4</span> Intervals<span></span></a></li>
</ul></li>
</ul></li>
<li><a href="producing-maps-for-plotting.html#producing-maps-for-plotting" id="toc-producing-maps-for-plotting"><span class="toc-section-number">6</span> Producing maps for plotting<span></span></a>
<ul>
<li><a href="producing-maps-using-ggmap.html#producing-maps-using-ggmap" id="toc-producing-maps-using-ggmap"><span class="toc-section-number">6.1</span> Producing maps using ggmap<span></span></a>
<ul>
<li><a href="producing-maps-using-ggmap.html#task-8" id="toc-task-8"><span class="toc-section-number">6.1.1</span> Task<span></span></a></li>
<li><a href="producing-maps-using-ggmap.html#answer-7" id="toc-answer-7"><span class="toc-section-number">6.1.2</span> Answer<span></span></a></li>
<li><a href="producing-maps-using-ggmap.html#producing-maps-using-leaflet" id="toc-producing-maps-using-leaflet"><span class="toc-section-number">6.1.3</span> Producing maps using leaflet<span></span></a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Visualising Data using R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="efficient-data-manipulation-using-dplyr" class="section level2 hasAnchor" number="3.5">
<h2><span class="header-section-number">3.5</span> Efficient data manipulation using dplyr<a href="efficient-data-manipulation-using-dplyr.html#efficient-data-manipulation-using-dplyr" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this section we will work with data from Paris’ Vélib’ bicycle sharing system available through <a href="https://developer.jcdecaux.com/">JCDecaux’s API</a> for <a href="https://developer.jcdecaux.com/#/opendata/">open cycle data</a>.</p>
<p>The data consists of the number of bikes available and the number of bike stands available at every Vélib’ station, recorded every five minutes over six hours on a Tuesday afternoon in October 2017.</p>
<p>The data consists of two tibbles. The first, <code>bikes</code> contains data on the number of available bikes and stands at each station.</p>
<table>
<thead>
<tr class="header">
<th>Variable</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>name</code></td>
<td>Name of the station</td>
</tr>
<tr class="even">
<td><code>available_bikes</code></td>
<td>Number of available at that time</td>
</tr>
<tr class="odd">
<td><code>available_bike_stands</code></td>
<td>Number of available bike stands</td>
</tr>
<tr class="even">
<td><code>time</code></td>
<td>Decimal time for which the number have been recorded</td>
</tr>
</tbody>
</table>
<p>The second, <code>stations</code> contains additional information about each station.</p>
<table>
<thead>
<tr class="header">
<th>Variable</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>name</code></td>
<td>Unique name of the station</td>
</tr>
<tr class="even">
<td><code>id</code></td>
<td>Internal ID number of the station</td>
</tr>
<tr class="odd">
<td><code>address</code></td>
<td>Address of where the station is located</td>
</tr>
<tr class="even">
<td><code>lng</code></td>
<td>GPS coordinate (longitude)</td>
</tr>
<tr class="odd">
<td><code>lat</code></td>
<td>GPS coordinate (latitude)</td>
</tr>
<tr class="even">
<td><code>departement</code></td>
<td>Département in which the station is located</td>
</tr>
</tbody>
</table>
<p>You can load the data into R using</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="efficient-data-manipulation-using-dplyr.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb50-2"><a href="efficient-data-manipulation-using-dplyr.html#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">url</span>(<span class="st">&quot;https://github.com/UofGAnalyticsData/R/raw/main/Week%204/velib&quot;</span>))</span></code></pre></div>
<div id="overview-the-key-functions-verbs-for-dplyr" class="section level3 hasAnchor" number="3.5.1">
<h3><span class="header-section-number">3.5.1</span> Overview: the key functions (“verbs”) for <code>dplyr</code><a href="efficient-data-manipulation-using-dplyr.html#overview-the-key-functions-verbs-for-dplyr" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<table>
<thead>
<tr class="header">
<th>Function (“verb”)</th>
<th>Description</th>
<th>R base equivalent(s)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>filter</code></td>
<td>Select observations/rows</td>
<td><code>subset</code></td>
</tr>
<tr class="even">
<td><code>slice</code></td>
<td>Select observations by row numbers</td>
<td><code>[idx,]</code></td>
</tr>
<tr class="odd">
<td><code>select</code></td>
<td>Select variables/column</td>
<td><code>$</code> or <code>[,sel]</code></td>
</tr>
<tr class="even">
<td><code>mutate</code></td>
<td>Create new variables/column</td>
<td><code>transform</code></td>
</tr>
<tr class="odd">
<td><code>arrange</code></td>
<td>Sort observations/rows</td>
<td><code>order</code></td>
</tr>
<tr class="even">
<td><code>group_by</code></td>
<td>Group observations by variable</td>
<td><code>by</code> or <code>aggregate</code></td>
</tr>
<tr class="odd">
<td><code>summarise</code></td>
<td>Calculate summary statistics</td>
<td><code>by</code> or <code>aggregate</code></td>
</tr>
</tbody>
</table>
<p>The functions in <code>dplyr</code> are designed to be used with tibbles, but they also work with data frames. When invoked with a data frame, they will return a data frame as long as this is possible.</p>
</div>
<div id="selecting-observations-rows-using-filter-and-slice" class="section level3 hasAnchor" number="3.5.2">
<h3><span class="header-section-number">3.5.2</span> Selecting observations (rows) using <code>filter</code> and <code>slice</code><a href="efficient-data-manipulation-using-dplyr.html#selecting-observations-rows-using-filter-and-slice" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="filter" class="section level4 hasAnchor" number="3.5.2.1">
<h4><span class="header-section-number">3.5.2.1</span> <code>filter</code><a href="efficient-data-manipulation-using-dplyr.html#filter" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The function <code>filter</code> is used to select observations (or rows) in a similar way to the base R function <code>subset</code>.</p>
<p>Suppose we want to print all bike stations in Paris (rather than other départements from Île de France)</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="efficient-data-manipulation-using-dplyr.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb51-2"><a href="efficient-data-manipulation-using-dplyr.html#cb51-2" aria-hidden="true" tabindex="-1"></a>stations75 <span class="ot">&lt;-</span> stations <span class="sc">%&gt;%</span></span>
<span id="cb51-3"><a href="efficient-data-manipulation-using-dplyr.html#cb51-3" aria-hidden="true" tabindex="-1"></a>                <span class="fu">filter</span>(departement<span class="sc">==</span><span class="st">&quot;Paris&quot;</span>)</span>
<span id="cb51-4"><a href="efficient-data-manipulation-using-dplyr.html#cb51-4" aria-hidden="true" tabindex="-1"></a>stations75</span></code></pre></div>
<pre><code>## # A tibble: 743 × 6
##    name                                       id address   lng   lat departement
##    &lt;chr&gt;                                   &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;      
##  1 PORT SOLFERINO (STATION MOBILE)           901 BERGES…  2.32  48.9 Paris      
##  2 QUAI MAURIAC  / PONT DE BERCY             903 FETE D…  2.37  48.8 Paris      
##  3 17/19 PLACE JOFFRE / ECOLE MILITAIRE      904 ECOLE …  2.30  48.9 Paris      
##  4 CONCORDE/BERGES DE SEINE (STATION MOBI…   905 BERGES…  2.32  48.9 Paris      
##  5 PORT DU GROS CAILLOU (STATION MOBILE)     908 BERGES…  2.31  48.9 Paris      
##  6 PONT D&#39;ARCOLE (STATION MOBILE)            909 Voie G…  2.35  48.9 Paris      
##  7 ILE DE LA CITE PONT NEUF                 1001 41 QUA…  2.34  48.9 Paris      
##  8 PLACE DU CHATELET                        1002 14 AVE…  2.35  48.9 Paris      
##  9 RIVOLI SAINT DENIS                       1003 7 RUE …  2.35  48.9 Paris      
## 10 MARGUERITE DE NAVARRE                    1004 12 RUE…  2.35  48.9 Paris      
## # … with 733 more rows</code></pre>
<p>Note the use of a double <code>==</code> to test whether the département is equal to “Paris”.</p>
<p>We can create more complex expressions using the standard logical operators <code>&amp;</code> (“and”), <code>|</code> (“or”) and <code>!</code> (“not”). Note that you <em>cannot</em> use <code>&amp;&amp;</code> and <code>||</code> in this context, as they only work with scalar arguments.</p>
<p>For example, if we want to extract the stations which are in Paris or Hauts-de-Seine we can use</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="efficient-data-manipulation-using-dplyr.html#cb53-1" aria-hidden="true" tabindex="-1"></a>stations7592 <span class="ot">&lt;-</span> stations <span class="sc">%&gt;%</span></span>
<span id="cb53-2"><a href="efficient-data-manipulation-using-dplyr.html#cb53-2" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(departement<span class="sc">==</span><span class="st">&quot;Paris&quot;</span> <span class="sc">|</span> departement<span class="sc">==</span><span class="st">&quot;Hauts-de-Seine&quot;</span>)</span></code></pre></div>
<p>Rather than using a logical or we could have used <code>%in%</code>:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="efficient-data-manipulation-using-dplyr.html#cb54-1" aria-hidden="true" tabindex="-1"></a>stations7592 <span class="ot">&lt;-</span> stations <span class="sc">%&gt;%</span></span>
<span id="cb54-2"><a href="efficient-data-manipulation-using-dplyr.html#cb54-2" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(departement <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Paris&quot;</span> , <span class="st">&quot;Hauts-de-Seine&quot;</span>))</span></code></pre></div>
<p>Even though the functions from <code>dplyr</code> are designed to be used with pipelines, you can also provide the data set as first argument:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="efficient-data-manipulation-using-dplyr.html#cb55-1" aria-hidden="true" tabindex="-1"></a>stations7592 <span class="ot">&lt;-</span> <span class="fu">filter</span>(stations, departement <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Paris&quot;</span> , <span class="st">&quot;Hauts-de-Seine&quot;</span>))</span></code></pre></div>
</div>
<div id="slice" class="section level4 hasAnchor" number="3.5.2.2">
<h4><span class="header-section-number">3.5.2.2</span> <code>slice</code><a href="efficient-data-manipulation-using-dplyr.html#slice" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>You can use the function <code>slice</code> to select observations based on their row numbers.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="efficient-data-manipulation-using-dplyr.html#cb56-1" aria-hidden="true" tabindex="-1"></a>stations <span class="sc">%&gt;%</span></span>
<span id="cb56-2"><a href="efficient-data-manipulation-using-dplyr.html#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">7</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 6
##   name                                     id address      lng   lat departement
##   &lt;chr&gt;                                 &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;      
## 1 PORT DU GROS CAILLOU (STATION MOBILE)   908 BERGES DE…  2.31  48.9 Paris      
## 2 PONT D&#39;ARCOLE (STATION MOBILE)          909 Voie Geor…  2.35  48.9 Paris      
## 3 ILE DE LA CITE PONT NEUF               1001 41 QUAI D…  2.34  48.9 Paris</code></pre>
<p>selects the observations in rows 5 to 7 and is equivalent to</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="efficient-data-manipulation-using-dplyr.html#cb58-1" aria-hidden="true" tabindex="-1"></a>stations[<span class="dv">5</span><span class="sc">:</span><span class="dv">7</span>,]</span></code></pre></div>
<pre><code>## # A tibble: 3 × 6
##   name                                     id address      lng   lat departement
##   &lt;chr&gt;                                 &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;      
## 1 PORT DU GROS CAILLOU (STATION MOBILE)   908 BERGES DE…  2.31  48.9 Paris      
## 2 PONT D&#39;ARCOLE (STATION MOBILE)          909 Voie Geor…  2.35  48.9 Paris      
## 3 ILE DE LA CITE PONT NEUF               1001 41 QUAI D…  2.34  48.9 Paris</code></pre>
</div>
</div>
<div id="task-3" class="section level3 hasAnchor" number="3.5.3">
<h3><span class="header-section-number">3.5.3</span> Task<a href="efficient-data-manipulation-using-dplyr.html#task-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Identify the stations which had more than 60 bikes available at 3pm (i.e. <code>time</code> taking the value 15).</p>
</div>
<div id="answer-2" class="section level3 hasAnchor" number="3.5.4">
<h3><span class="header-section-number">3.5.4</span> Answer<a href="efficient-data-manipulation-using-dplyr.html#answer-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You can use the following R code:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="efficient-data-manipulation-using-dplyr.html#cb60-1" aria-hidden="true" tabindex="-1"></a>bikes <span class="sc">%&gt;%</span></span>
<span id="cb60-2"><a href="efficient-data-manipulation-using-dplyr.html#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(time<span class="sc">==</span><span class="dv">15</span> <span class="sc">&amp;</span> available_bikes<span class="sc">&gt;</span><span class="dv">60</span>)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
##   name                available_bikes available_bike_stands  time
##   &lt;chr&gt;                         &lt;int&gt;                 &lt;int&gt; &lt;dbl&gt;
## 1 MUSÉE D&#39;ORSAY                    63                     2    15
## 2 DUPLEIX                          65                     3    15
## 3 ASSEMBLEE NATIONALE              62                     0    15
## 4 SAINT EMILION                    65                     1    15
## 5 METZ                             63                     1    15
## 6 PRIMO LEVI                       61                     1    15</code></pre>
</div>
<div id="selecting-variables-columns-using-select" class="section level3 hasAnchor" number="3.5.5">
<h3><span class="header-section-number">3.5.5</span> Selecting variables (columns) using <code>select</code><a href="efficient-data-manipulation-using-dplyr.html#selecting-variables-columns-using-select" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The function <code>select</code> can be used to subset the variables (columns) of a data set.</p>
<p>You can either specify the columns to retain or (with a minus) those you do not want to retain.</p>
<p>We can only retain the name and département of each station using either</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="efficient-data-manipulation-using-dplyr.html#cb62-1" aria-hidden="true" tabindex="-1"></a>stations.small <span class="ot">&lt;-</span> stations <span class="sc">%&gt;%</span></span>
<span id="cb62-2"><a href="efficient-data-manipulation-using-dplyr.html#cb62-2" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">select</span>(name, departement)</span>
<span id="cb62-3"><a href="efficient-data-manipulation-using-dplyr.html#cb62-3" aria-hidden="true" tabindex="-1"></a>stations.small</span></code></pre></div>
<pre><code>## # A tibble: 928 × 2
##    name                                      departement
##    &lt;chr&gt;                                     &lt;chr&gt;      
##  1 PORT SOLFERINO (STATION MOBILE)           Paris      
##  2 QUAI MAURIAC  / PONT DE BERCY             Paris      
##  3 17/19 PLACE JOFFRE / ECOLE MILITAIRE      Paris      
##  4 CONCORDE/BERGES DE SEINE (STATION MOBILE) Paris      
##  5 PORT DU GROS CAILLOU (STATION MOBILE)     Paris      
##  6 PONT D&#39;ARCOLE (STATION MOBILE)            Paris      
##  7 ILE DE LA CITE PONT NEUF                  Paris      
##  8 PLACE DU CHATELET                         Paris      
##  9 RIVOLI SAINT DENIS                        Paris      
## 10 MARGUERITE DE NAVARRE                     Paris      
## # … with 918 more rows</code></pre>
<p>or</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="efficient-data-manipulation-using-dplyr.html#cb64-1" aria-hidden="true" tabindex="-1"></a>stations.small <span class="ot">&lt;-</span> stations <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>id, <span class="sc">-</span>address, <span class="sc">-</span>lng, <span class="sc">-</span>lat)</span></code></pre></div>
<p>You can also use <code>select</code> to change the order of the columns of a data set.</p>
</div>
<div id="adding-new-variables-using-mutate" class="section level3 hasAnchor" number="3.5.6">
<h3><span class="header-section-number">3.5.6</span> Adding new variables using <code>mutate</code><a href="efficient-data-manipulation-using-dplyr.html#adding-new-variables-using-mutate" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The function <code>mutate</code> can be used to create new variables (columns) in a data set. <code>mutate</code> is similar in functionality to the base R function <code>transform</code>.</p>
<p>We can add the total number of stands to the data set <code>bikes</code> using</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="efficient-data-manipulation-using-dplyr.html#cb65-1" aria-hidden="true" tabindex="-1"></a>bikes <span class="ot">&lt;-</span> bikes <span class="sc">%&gt;%</span></span>
<span id="cb65-2"><a href="efficient-data-manipulation-using-dplyr.html#cb65-2" aria-hidden="true" tabindex="-1"></a>           <span class="fu">mutate</span>(<span class="at">total_stands =</span> available_bikes<span class="sc">+</span>available_bike_stands)</span></code></pre></div>
<p>More than one new variable can be defined by adding further arguments to <code>mutate</code>.</p>
<p><code>transmute</code> is a sibling of <code>mutate</code>. Just like <code>mutate</code> it creates new columns. It however also removes all existing columns so that only the new columns remain.</p>
</div>
<div id="task-4" class="section level3 hasAnchor" number="3.5.7">
<h3><span class="header-section-number">3.5.7</span> Task<a href="efficient-data-manipulation-using-dplyr.html#task-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The time is currently encoded as decimal (e.g. <code>13.5</code> for 13:30). Create two columns <code>time_hours</code>, which contains the hour (13 in our example), and <code>time_minutes</code>, which contains the minutes, (30 in our example).</p>
<p>You can calculate <code>time_hours</code> as the floor of <code>time</code> (R function <code>floor</code>) and <code>time_minutes</code> as the remainder after integer division of 60 times <code>time</code> by 60 (R operator <code>%%</code>).</p>
</div>
<div id="answer-3" class="section level3 hasAnchor" number="3.5.8">
<h3><span class="header-section-number">3.5.8</span> Answer<a href="efficient-data-manipulation-using-dplyr.html#answer-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We can create both columns in one call to <code>mutate</code>.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="efficient-data-manipulation-using-dplyr.html#cb66-1" aria-hidden="true" tabindex="-1"></a>bikes <span class="sc">%&gt;%</span></span>
<span id="cb66-2"><a href="efficient-data-manipulation-using-dplyr.html#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time_hour=</span><span class="fu">floor</span>(time), <span class="at">time_minutes=</span>(<span class="dv">60</span><span class="sc">*</span>time)<span class="sc">%%</span><span class="dv">60</span>)</span></code></pre></div>
<pre><code>## # A tibble: 67,354 × 7
##    name            available_bikes available_bike_…  time total_stands time_hour
##    &lt;chr&gt;                     &lt;int&gt;            &lt;int&gt; &lt;dbl&gt;        &lt;int&gt;     &lt;dbl&gt;
##  1 CHAMPEAUX (BAG…               9               41    13           50        13
##  2 POISSONNIÈRE -…              33                0    13           33        13
##  3 METRO ROME                    6               38    13           44        13
##  4 DE GAULLE (PAN…               2               16    13           18        13
##  5 PARC DE BELLEV…               4               22    13           26        13
##  6 SOLJENITSYNE (…              56                4    13           60        13
##  7 SERRES                        5               18    13           23        13
##  8 PYRAMIDE ARTIL…              14               40    13           54        13
##  9 SAINT GEORGES                12               10    13           22        13
## 10 MUSÉE D&#39;ORSAY                65                0    13           65        13
## # … with 67,344 more rows, and 1 more variable: time_minutes &lt;dbl&gt;</code></pre>
<p>The output does not show the new columns (as they would take the output of a single row to more than one line). We can show them all, for example, if we remove the station name.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="efficient-data-manipulation-using-dplyr.html#cb68-1" aria-hidden="true" tabindex="-1"></a>bikes <span class="sc">%&gt;%</span></span>
<span id="cb68-2"><a href="efficient-data-manipulation-using-dplyr.html#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time_hour=</span><span class="fu">floor</span>(time), <span class="at">time_minutes=</span>(<span class="dv">60</span><span class="sc">*</span>time)<span class="sc">%%</span><span class="dv">60</span>) <span class="sc">%&gt;%</span></span>
<span id="cb68-3"><a href="efficient-data-manipulation-using-dplyr.html#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>name)</span></code></pre></div>
<pre><code>## # A tibble: 67,354 × 6
##    available_bikes available_bike_sta…  time total_stands time_hour time_minutes
##              &lt;int&gt;               &lt;int&gt; &lt;dbl&gt;        &lt;int&gt;     &lt;dbl&gt;        &lt;dbl&gt;
##  1               9                  41    13           50        13            0
##  2              33                   0    13           33        13            0
##  3               6                  38    13           44        13            0
##  4               2                  16    13           18        13            0
##  5               4                  22    13           26        13            0
##  6              56                   4    13           60        13            0
##  7               5                  18    13           23        13            0
##  8              14                  40    13           54        13            0
##  9              12                  10    13           22        13            0
## 10              65                   0    13           65        13            0
## # … with 67,344 more rows</code></pre>
<p>Alternatively, we can explicitly invoke the print method of the tibble and ask it to print everything.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="efficient-data-manipulation-using-dplyr.html#cb70-1" aria-hidden="true" tabindex="-1"></a>bikes <span class="sc">%&gt;%</span></span>
<span id="cb70-2"><a href="efficient-data-manipulation-using-dplyr.html#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time_hour=</span><span class="fu">floor</span>(time), <span class="at">time_minutes=</span>(<span class="dv">60</span><span class="sc">*</span>time)<span class="sc">%%</span><span class="dv">60</span>) <span class="sc">%&gt;%</span></span>
<span id="cb70-3"><a href="efficient-data-manipulation-using-dplyr.html#cb70-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">width=</span><span class="cn">Inf</span>)</span></code></pre></div>
<pre><code>## # A tibble: 67,354 × 7
##    name                       available_bikes available_bike_stands  time
##    &lt;chr&gt;                                &lt;int&gt;                 &lt;int&gt; &lt;dbl&gt;
##  1 CHAMPEAUX (BAGNOLET)                     9                    41    13
##  2 POISSONNIÈRE - ENGHIEN                  33                     0    13
##  3 METRO ROME                               6                    38    13
##  4 DE GAULLE (PANTIN)                       2                    16    13
##  5 PARC DE BELLEVILLE (20040)               4                    22    13
##  6 SOLJENITSYNE (PUTEAUX)                  56                     4    13
##  7 SERRES                                   5                    18    13
##  8 PYRAMIDE ARTILLERIE                     14                    40    13
##  9 SAINT GEORGES                           12                    10    13
## 10 MUSÉE D&#39;ORSAY                           65                     0    13
##    total_stands time_hour time_minutes
##           &lt;int&gt;     &lt;dbl&gt;        &lt;dbl&gt;
##  1           50        13            0
##  2           33        13            0
##  3           44        13            0
##  4           18        13            0
##  5           26        13            0
##  6           60        13            0
##  7           23        13            0
##  8           54        13            0
##  9           22        13            0
## 10           65        13            0
## # … with 67,344 more rows</code></pre>
</div>
<div id="sorting-data-sets-using-arrange" class="section level3 hasAnchor" number="3.5.9">
<h3><span class="header-section-number">3.5.9</span> Sorting data sets using <code>arrange</code><a href="efficient-data-manipulation-using-dplyr.html#sorting-data-sets-using-arrange" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The function <code>arrange</code> can be used to sort a data set by one or more variables.
We can sort the data set <code>bikes</code> by the number of available bikes suing</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="efficient-data-manipulation-using-dplyr.html#cb72-1" aria-hidden="true" tabindex="-1"></a>bikes <span class="sc">%&gt;%</span></span>
<span id="cb72-2"><a href="efficient-data-manipulation-using-dplyr.html#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(available_bikes)</span></code></pre></div>
<pre><code>## # A tibble: 67,354 × 5
##    name                      available_bikes available_bike_…  time total_stands
##    &lt;chr&gt;                               &lt;int&gt;            &lt;int&gt; &lt;dbl&gt;        &lt;int&gt;
##  1 KARMAN (AUBERVILLIERS)                  0                0    13            0
##  2 PIGALLE GERMAIN PILLON                  0               20    13           20
##  3 ROND POINT DES CHAMPS EL…               0                0    13            0
##  4 MONTCALM                                0               47    13           47
##  5 PLACE HENOCQUE VERSION 2                0               34    13           34
##  6 PLACE DES FETES                         0               19    13           19
##  7 MANIN SECRETAN                          0               20    13           20
##  8 MARTINIE (VANVES)                       0               24    13           24
##  9 HORTENSIAS (LES LILAS)                  0               22    13           22
## 10 HAIES REUNION                           0               22    13           22
## # … with 67,344 more rows</code></pre>
<p>You can use the function <code>desc</code> to sort in descending order</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="efficient-data-manipulation-using-dplyr.html#cb74-1" aria-hidden="true" tabindex="-1"></a>bikes <span class="sc">%&gt;%</span></span>
<span id="cb74-2"><a href="efficient-data-manipulation-using-dplyr.html#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(available_bikes))</span></code></pre></div>
<pre><code>## # A tibble: 67,354 × 5
##    name    available_bikes available_bike_stands  time total_stands
##    &lt;chr&gt;             &lt;int&gt;                 &lt;int&gt; &lt;dbl&gt;        &lt;int&gt;
##  1 DUPLEIX              68                     0  16.2           68
##  2 DUPLEIX              68                     0  16.2           68
##  3 DUPLEIX              67                     1  15.4           68
##  4 DUPLEIX              67                     1  15.5           68
##  5 DUPLEIX              67                     1  15.8           68
##  6 DUPLEIX              67                     1  16.1           68
##  7 DUPLEIX              67                     1  16.3           68
##  8 SAHEL                67                     0  17.6           67
##  9 SAHEL                67                     0  18             67
## 10 SAHEL                67                     0  18.1           67
## # … with 67,344 more rows</code></pre>
</div>
<div id="task-5" class="section level3 hasAnchor" number="3.5.10">
<h3><span class="header-section-number">3.5.10</span> Task<a href="efficient-data-manipulation-using-dplyr.html#task-5" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Identify the three bike stations that are furthest to the West (i.e. the ones with the smallest longitude <code>lng</code>).</p>
</div>
<div id="answer-4" class="section level3 hasAnchor" number="3.5.11">
<h3><span class="header-section-number">3.5.11</span> Answer<a href="efficient-data-manipulation-using-dplyr.html#answer-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We first sort the stations by the longitude and the select to top three observations.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="efficient-data-manipulation-using-dplyr.html#cb76-1" aria-hidden="true" tabindex="-1"></a>stations <span class="sc">%&gt;%</span></span>
<span id="cb76-2"><a href="efficient-data-manipulation-using-dplyr.html#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(lng) <span class="sc">%&gt;%</span></span>
<span id="cb76-3"><a href="efficient-data-manipulation-using-dplyr.html#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 6
##   name                            id address               lng   lat departement
##   &lt;chr&gt;                        &lt;dbl&gt; &lt;chr&gt;               &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;      
## 1 GARE ROUTIERE ( SAINT CLOUD) 22101 GARE ROUTIERE - AR…  2.22  48.8 Hauts-de-S…
## 2 SELLIER (SURESNES)           21501 RUE DE SAINT CLOUD…  2.23  48.9 Hauts-de-S…
## 3 VERDUN (SURESNES)            21502 18 BIS RUE DE VERD…  2.23  48.9 Hauts-de-S…</code></pre>
<p>We could have also used the function <code>filter</code> and the ranking function <code>min_rank</code>:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="efficient-data-manipulation-using-dplyr.html#cb78-1" aria-hidden="true" tabindex="-1"></a>stations <span class="sc">%&gt;%</span></span>
<span id="cb78-2"><a href="efficient-data-manipulation-using-dplyr.html#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">min_rank</span>(lng)<span class="sc">&lt;=</span><span class="dv">3</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 6
##   name                            id address               lng   lat departement
##   &lt;chr&gt;                        &lt;dbl&gt; &lt;chr&gt;               &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;      
## 1 SELLIER (SURESNES)           21501 RUE DE SAINT CLOUD…  2.23  48.9 Hauts-de-S…
## 2 VERDUN (SURESNES)            21502 18 BIS RUE DE VERD…  2.23  48.9 Hauts-de-S…
## 3 GARE ROUTIERE ( SAINT CLOUD) 22101 GARE ROUTIERE - AR…  2.22  48.8 Hauts-de-S…</code></pre>
<p><code>min_rank</code> returns the rank of the observation when considering the variable given as argument (there are many different ways of computing ranks, see <code>?min_rank</code> for details.)</p>
<p>However, the latter answer does not show the stations in increasing order of longitude.</p>
</div>
<div id="grouping-data-and-calculating-group-wise-summary-statistics-group_by-and-summarise" class="section level3 hasAnchor" number="3.5.12">
<h3><span class="header-section-number">3.5.12</span> Grouping data and calculating group-wise summary statistics: <code>group_by</code> and <code>summarise</code><a href="efficient-data-manipulation-using-dplyr.html#grouping-data-and-calculating-group-wise-summary-statistics-group_by-and-summarise" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Suppose we want to identify the busiest stations in the system in the sense of having, on average, the most bikes taken out (and thus the highest number of available bike stands – this is assuming JCDecaux replenish all bike stations in the same way, which is not quite what is happening in reality; there are better, but more complex, ways of defining “busy”).</p>
<p>To calculate the average number of available bike stands per station we need to first group the data by bike station and then compute the average number of bike stands available</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="efficient-data-manipulation-using-dplyr.html#cb80-1" aria-hidden="true" tabindex="-1"></a>bikes <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span>                             <span class="co"># Group by station name</span></span>
<span id="cb80-2"><a href="efficient-data-manipulation-using-dplyr.html#cb80-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_stands=</span><span class="fu">mean</span>(available_bike_stands)) <span class="sc">%&gt;%</span>  <span class="co"># Calculate averages</span></span>
<span id="cb80-3"><a href="efficient-data-manipulation-using-dplyr.html#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(avg_stands))                              <span class="co"># Sort in descending order</span></span></code></pre></div>
<pre><code>## # A tibble: 928 × 2
##    name                               avg_stands
##    &lt;chr&gt;                                   &lt;dbl&gt;
##  1 PANTIN                                   70.3
##  2 BELLEVILLE (20041)                       65.1
##  3 PLACE ADOLPHE CHERIOUX                   60  
##  4 HIPPODROME D AUTEUIL                     60.0
##  5 RUE DES BOULETS ( COMPLEMENTAIRE )       55  
##  6 PLACE DE LA PORTE DE CHATILLON           54.9
##  7 PORTE DE LA CHAPELLE                     54.1
##  8 CHARMES (FONTENAY SOUS BOIS)             53.5
##  9 PORTE DE MONTROUGE                       53  
## 10 ALLENDE (PANTIN)                         52.9
## # … with 918 more rows</code></pre>
</div>
<div id="task-6" class="section level3 hasAnchor" number="3.5.13">
<h3><span class="header-section-number">3.5.13</span> Task<a href="efficient-data-manipulation-using-dplyr.html#task-6" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Find the number of bike stations in each département.</p>
<p>You might find the function <code>n()</code> helpful, which returns the number of cases and is the <code>dplyr</code> equivalent of <code>COUNT(*)</code> in SQL (type <code>?n</code> to get help).</p>
</div>
<div id="answer-5" class="section level3 hasAnchor" number="3.5.14">
<h3><span class="header-section-number">3.5.14</span> Answer<a href="efficient-data-manipulation-using-dplyr.html#answer-5" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We can use the following R code:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="efficient-data-manipulation-using-dplyr.html#cb82-1" aria-hidden="true" tabindex="-1"></a>stations <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(departement) <span class="sc">%&gt;%</span>         <span class="co"># Group by department</span></span>
<span id="cb82-2"><a href="efficient-data-manipulation-using-dplyr.html#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_stations=</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span>                <span class="co"># Count cases</span></span>
<span id="cb82-3"><a href="efficient-data-manipulation-using-dplyr.html#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n_stations))                    <span class="co"># Sort in descending order</span></span></code></pre></div>
<pre><code>## # A tibble: 4 × 2
##   departement       n_stations
##   &lt;chr&gt;                  &lt;int&gt;
## 1 Paris                    743
## 2 Hauts-de-Seine            75
## 3 Seine-Saint-Denis         60
## 4 Val-de-Marne              50</code></pre>
<p><code>group_by</code> can be also used to limit the scope of subsequent calls to other functions such as <code>filter</code>, <code>arrange</code> or <code>slice</code>. To make this more concrete, suppose we want to find for each time point the station which the most available bikes. We first have group the data by <code>time</code> and then find the station with the most available bikes.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="efficient-data-manipulation-using-dplyr.html#cb84-1" aria-hidden="true" tabindex="-1"></a>bikes <span class="sc">%&gt;%</span>                                     </span>
<span id="cb84-2"><a href="efficient-data-manipulation-using-dplyr.html#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(time) <span class="sc">%&gt;%</span>                           <span class="co"># Group by time</span></span>
<span id="cb84-3"><a href="efficient-data-manipulation-using-dplyr.html#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(available_bikes)) <span class="sc">%&gt;%</span>           <span class="co"># Sort by bikes within each group</span></span>
<span id="cb84-4"><a href="efficient-data-manipulation-using-dplyr.html#cb84-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span> (<span class="dv">1</span>)                                    <span class="co"># Return only top one per group</span></span></code></pre></div>
<pre><code>## # A tibble: 73 × 5
## # Groups:   time [73]
##    name          available_bikes available_bike_stands  time total_stands
##    &lt;chr&gt;                   &lt;int&gt;                 &lt;int&gt; &lt;dbl&gt;        &lt;int&gt;
##  1 MUSÉE D&#39;ORSAY              65                     0  13             65
##  2 MUSÉE D&#39;ORSAY              65                     0  13.1           65
##  3 MUSÉE D&#39;ORSAY              65                     0  13.2           65
##  4 MUSÉE D&#39;ORSAY              62                     3  13.2           65
##  5 METZ                       64                     0  13.3           64
##  6 DUPLEIX                    64                     4  13.4           68
##  7 METZ                       64                     0  13.5           64
##  8 MUSÉE D&#39;ORSAY              63                     2  13.6           65
##  9 SAINT EMILION              63                     3  13.7           66
## 10 MUSÉE D&#39;ORSAY              65                     0  13.8           65
## # … with 63 more rows</code></pre>
<p>Alternatively, we can use <code>filter</code> and <code>min_rank</code>:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="efficient-data-manipulation-using-dplyr.html#cb86-1" aria-hidden="true" tabindex="-1"></a>bikes <span class="sc">%&gt;%</span>                                     </span>
<span id="cb86-2"><a href="efficient-data-manipulation-using-dplyr.html#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(time) <span class="sc">%&gt;%</span>                           <span class="co"># Group by time</span></span>
<span id="cb86-3"><a href="efficient-data-manipulation-using-dplyr.html#cb86-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">min_rank</span>(<span class="fu">desc</span>(available_bikes))<span class="sc">==</span><span class="dv">1</span>)   <span class="co"># Find largest in each group</span></span></code></pre></div>
<pre><code>## # A tibble: 92 × 5
## # Groups:   time [73]
##    name                      available_bikes available_bike_…  time total_stands
##    &lt;chr&gt;                               &lt;int&gt;            &lt;int&gt; &lt;dbl&gt;        &lt;int&gt;
##  1 MUSÉE D&#39;ORSAY                          65                0  13             65
##  2 MUSÉE D&#39;ORSAY                          65                0  13.1           65
##  3 MUSÉE D&#39;ORSAY                          65                0  13.2           65
##  4 MUSÉE D&#39;ORSAY                          62                3  13.2           65
##  5 MOUFFETARD EPEE DE BOIS                62                1  13.2           63
##  6 SAINT PLACIDE CHERCHE MI…              62                0  13.2           62
##  7 METZ                                   64                0  13.3           64
##  8 DUPLEIX                                64                4  13.4           68
##  9 METZ                                   64                0  13.4           64
## 10 METZ                                   64                0  13.5           64
## # … with 82 more rows</code></pre>
<p>You might have noticed that the answers differ a little. The reason for this are ties: for example, at 1.15pm the stations at Mussée d’Orsay, Mouffetard Epée de Bois and Sainte Placide Cherche-Midi all had 62 bikes available. The former commands extracts just one of them, whereas the bottom command extracts all three.
(You would obtain the same results if you replaced <code>min_rank</code> by <code>row_number</code>, which breaks ties by using in doubt the order in the data set).</p>
</div>
<div id="merging-joining-data-sets-using-the-join-type-functions" class="section level3 hasAnchor" number="3.5.15">
<h3><span class="header-section-number">3.5.15</span> Merging (joining) data sets using the <code>join</code>-type functions<a href="efficient-data-manipulation-using-dplyr.html#merging-joining-data-sets-using-the-join-type-functions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Suppose we want to extract the data from <code>bikes</code> relating to bike stations in Hauts-de-Seine only. The table <code>bikes</code> does not however contain any information about the département in which the stations are located. We need to merge the information from the <code>stations</code> and <code>bikes</code>. This can be done using one of the <code>join</code> functions of <code>dplyr</code>. We will use <code>inner_join</code>, which only retains cases if there are corresponding entries in both data sets: this corresponds to the default behaviour of the R function <code>merge</code>.</p>
<p>The <code>join</code> functions will be default use the columns with common names across the two data sets (“natural join”).</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="efficient-data-manipulation-using-dplyr.html#cb88-1" aria-hidden="true" tabindex="-1"></a>bikes <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(stations) <span class="sc">%&gt;%</span>              <span class="co"># Merge data (using common variable: name)</span></span>
<span id="cb88-2"><a href="efficient-data-manipulation-using-dplyr.html#cb88-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(departement<span class="sc">==</span><span class="st">&quot;Hauts-de-Seine&quot;</span>)</span></code></pre></div>
<pre><code>## Joining, by = &quot;name&quot;</code></pre>
<pre><code>## # A tibble: 5,333 × 10
##    name  available_bikes available_bike_…  time total_stands    id address   lng
##    &lt;chr&gt;           &lt;int&gt;            &lt;int&gt; &lt;dbl&gt;        &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;
##  1 SOLJ…              56                4    13           60 28002 BOULEV…  2.25
##  2 DE G…               3               19    13           22 22005 195 AV…  2.26
##  3 NATI…              20                3    13           23 21015 39 RUE…  2.24
##  4 MONT…              20                5    13           25 22011 7 RUE …  2.28
##  5 PETI…              22                0    13           22 21113 2 RUE …  2.30
##  6 GREN…               9               12    13           21 21013 4 AVEN…  2.25
##  7 MART…               0               24    13           24 21703 5-7 AV…  2.29
##  8 MORI…              22                3    13           25 21106 2-4 RU…  2.31
##  9 SELL…              34               17    13           51 21501 RUE DE…  2.23
## 10 VALI…              22                2    13           24 21101 4 RUE …  2.30
## # … with 5,323 more rows, and 2 more variables: lat &lt;dbl&gt;, departement &lt;chr&gt;</code></pre>
<p>We could have specified the column to used to join the data sets manually by adding the argument <code>by="name"</code> (or <code>by=c("name"="name")</code>, which allows using columns with different names in the two data set).</p>
<p>As a side note, in this example, we could have avoided joining the two tables. We could have first extracted the names of the stations in Hauts-de-Seine and then used those to subset the data from <code>bikes</code> (essentially the equivalent of a subquery in SQL):</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="efficient-data-manipulation-using-dplyr.html#cb91-1" aria-hidden="true" tabindex="-1"></a>names92 <span class="ot">&lt;-</span> stations <span class="sc">%&gt;%</span> <span class="fu">filter</span>(departement<span class="sc">==</span><span class="st">&quot;Hauts-de-Seine&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb91-2"><a href="efficient-data-manipulation-using-dplyr.html#cb91-2" aria-hidden="true" tabindex="-1"></a>               <span class="fu">select</span>(name) </span>
<span id="cb91-3"><a href="efficient-data-manipulation-using-dplyr.html#cb91-3" aria-hidden="true" tabindex="-1"></a>bikes <span class="sc">%&gt;%</span> <span class="fu">filter</span>(name <span class="sc">%in%</span> names92[[<span class="dv">1</span>]]) </span></code></pre></div>
<pre><code>## # A tibble: 5,333 × 5
##    name                      available_bikes available_bike_…  time total_stands
##    &lt;chr&gt;                               &lt;int&gt;            &lt;int&gt; &lt;dbl&gt;        &lt;int&gt;
##  1 SOLJENITSYNE (PUTEAUX)                 56                4    13           60
##  2 DE GAULLE 3 (NEUILLY)                   3               19    13           22
##  3 NATIONALE (BOULOGNE-BILL…              20                3    13           23
##  4 MONTROSIER (NEUILLY)                   20                5    13           25
##  5 PETIT (CLICHY)                         22                0    13           22
##  6 GRENIER (BOULOGNE-BILLAN…               9               12    13           21
##  7 MARTINIE (VANVES)                       0               24    13           24
##  8 MORICE 2 (CLICHY)                      22                3    13           25
##  9 SELLIER (SURESNES)                     34               17    13           51
## 10 VALITON (CLICHY)                       22                2    13           24
## # … with 5,323 more rows</code></pre>
<p>We had to use <code>names92[[1]]</code> to extract the entries of the tibble <code>names92</code> as a character vector (we could have also used <code>unlist(names92)</code>).</p>
<p>You might notice a small difference in the results returned by the two approaches. The former retains the columns from <code>stations</code> which we have inserted, whereas the latter only contains the columns which <code>bikes</code> contained to start with.</p>
</div>
<div id="additional-resources-2" class="section level3 hasAnchor" number="3.5.16">
<h3><span class="header-section-number">3.5.16</span> Additional Resources<a href="efficient-data-manipulation-using-dplyr.html#additional-resources-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><a href="%22https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf%22">Data Transformation Cheat Sheet</a>
RStudio have put together a very handy and compact cheat sheet for dplyr.</p>
<p><a href="%22http://r4ds.had.co.nz/relational-data.html%22,%20icon=%22book%22">Background reading: Chapter 13 of R for Data Science</a>
Chapter 13 of <em>R for Data Science</em> gives a detailed overview of the functions in <code>dplyr</code>.</p>

</div>
</div>
<!-- </div> -->
            </section>

          </div>
        </div>
      </div>
<a href="reading-in-data-using-readr.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="creating-graphics-with-ggplot2.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="assets/gitbook-2.6.7/js/app.min.js"></script>
<script src="assets/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="assets/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/02-tidyverse.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
},
"toolbar": {
"position": "static"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
